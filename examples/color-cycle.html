<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Color Cycling - MapLibre Transition</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.css"
    />
    <link rel="stylesheet" href="styles/shared.css" />
    <script src="https://unpkg.com/maplibre-gl@4/dist/maplibre-gl.js"></script>
  </head>
  <body>
    <header>
      <div class="header-content">
        <a href="./" class="logo">
          <div class="logo-icon">T</div>
          <h1>MapLibre Transition</h1>
        </a>
        <nav>
          <a href="./">Examples</a>
          <a
            href="https://github.com/popkinj/maplibre-transition"
            target="_blank"
            >GitHub</a
          >
        </nav>
      </div>
    </header>

    <main>
      <div class="example-container">
        <div class="map-container">
          <div id="map" data-testid="map-container"></div>
          <div class="controls">
            <h2>Color Cycling</h2>
            <p>
              Click on a Canadian city to animate it through the selected color
              palette.
            </p>

            <div class="control-group">
              <label
                >Duration:
                <span class="value-display" id="duration-value"
                  >3000ms</span
                ></label
              >
              <input
                type="range"
                id="duration"
                data-testid="duration-slider"
                min="1000"
                max="10000"
                value="3000"
                step="500"
              />
            </div>

            <div class="control-group">
              <label>Easing Function</label>
              <select id="easing" data-testid="easing-select">
                <option value="linear" selected>Linear</option>
                <option value="quad">Quadratic</option>
                <option value="cubic">Cubic</option>
                <option value="sin">Sinusoidal</option>
                <option value="elastic">Elastic</option>
              </select>
            </div>

            <div class="control-group">
              <label>Color Palette</label>
              <select id="palette" data-testid="palette-select">
                <option value="rainbow" selected>Rainbow</option>
                <option value="warm">Warm Tones</option>
                <option value="cool">Cool Tones</option>
                <option value="sunset">Sunset</option>
                <option value="ocean">Ocean</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script type="module">
      import MaplibreTransition from "../dist/index.esm.js";
      import { canadianCapitalCities } from "./data/canadian-cities.js";

      const map = new maplibregl.Map({
        container: "map",
        style: "https://demotiles.maplibre.org/style.json",
        center: [-95, 60],
        zoom: 3,
      });

      MaplibreTransition.init(map);

      // Expose test hooks for Playwright
      window.__testHooks = {
        map: map,
        getTransitionCount: () => map.transition.transitions.size,
        waitForLoad: () =>
          new Promise((resolve) => {
            if (map.loaded()) resolve();
            else map.once("load", resolve);
          }),
      };

      const palettes = {
        rainbow: ["#088", "#f00", "#00f", "#ff0", "#f0f", "#0ff", "#088"],
        warm: [
          "#ff6b35",
          "#f7931e",
          "#fdc830",
          "#f37335",
          "#c02425",
          "#ff6b35",
        ],
        cool: [
          "#667eea",
          "#764ba2",
          "#f093fb",
          "#4facfe",
          "#00f2fe",
          "#667eea",
        ],
        sunset: [
          "#ff512f",
          "#dd2476",
          "#f79d00",
          "#64f38c",
          "#dd2476",
          "#ff512f",
        ],
        ocean: [
          "#2e3192",
          "#1bffff",
          "#11998e",
          "#38ef7d",
          "#1bffff",
          "#2e3192",
        ],
      };

      map.on("load", () => {
        // Add Canadian cities
        map.addSource("cities", {
          type: "geojson",
          data: canadianCapitalCities,
          generateId: true,
        });

        map.addLayer({
          id: "cities-layer",
          type: "circle",
          source: "cities",
          paint: {
            "circle-radius": 25,
            "circle-color": "#088",
            "circle-opacity": 0.8,
            "circle-stroke-width": 2,
            "circle-stroke-color": "#ffffff",
          },
        });

        // Get controls
        const durationSlider = document.getElementById("duration");
        const durationValue = document.getElementById("duration-value");
        const easingSelect = document.getElementById("easing");
        const paletteSelect = document.getElementById("palette");

        durationSlider.addEventListener("input", (e) => {
          durationValue.textContent = `${e.target.value}ms`;
        });

        // Click handler - animate the clicked city through the color palette
        map.on("click", "cities-layer", (e) => {
          const feature = e.features[0];
          const duration = parseInt(durationSlider.value);
          const ease = easingSelect.value;
          const colors = palettes[paletteSelect.value];

          map.transition(feature, {
            duration: duration,
            ease: ease,
            paint: {
              "circle-color": colors,
            },
          });
        });

        // Change cursor on hover
        map.on("mouseenter", "cities-layer", () => {
          map.getCanvas().style.cursor = "pointer";
        });

        map.on("mouseleave", "cities-layer", () => {
          map.getCanvas().style.cursor = "";
        });
      });
    </script>
  </body>
</html>
